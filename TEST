-- Tối ưu hóa hiệu suất
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local Camera = workspace.CurrentCamera
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()
local UserInputService = game:GetService("UserInputService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local GuiService = game:GetService("GuiService")
local HttpService = game:GetService("HttpService")
local Drawing = Drawing or loadstring(game:HttpGet("https://raw.githubusercontent.com/FakeAngles/PasteWare/refs/heads/main/drawing_lib.lua"))()

-- Bổ sung xử lý cho thiết bị di động
local UIS = game:GetService("UserInputService")
if UIS.TouchEnabled and not UIS.MouseEnabled and not UIS.KeyboardEnabled then
    getgenv().bypass_adonis = true
    loadstring(game:HttpGet('https://raw.githubusercontent.com/FakeAngles/PasteWare/refs/heads/main/PasteWareMobile.lua'))()
    return
end

-- Bypass hệ thống phát hiện cheat tối ưu
if not game:IsLoaded() then 
    game.Loaded:Wait()
end

if not syn or not protectgui then
    getgenv().protectgui = function() end
end

task.spawn(function()
    local bypassFuncs = {}
    for _, v in pairs(getgc(true)) do
        if type(v) == "table" and rawget(v, "Detected") then
            bypassFuncs[#bypassFuncs+1] = v
        end
    end
    for _, func in pairs(bypassFuncs) do
        setmetatable(func, {
            __index = function() return function() return true end end
        })
    end
end)

-- Silent Aim
getgenv().SilentAimSettings = {
    Enabled = false,
    TargetPart = "HumanoidRootPart",
    FOVRadius = 130,
    FOVVisible = false,
    HitChance = 100
}

-- AimLock
local isLockedOn = false
local targetPlayer = nil
local smoothingFactor = 0.1
local predictionFactor = 0.0

RunService.RenderStepped:Connect(function()
    if isLockedOn and targetPlayer then
        local predictedPosition = targetPlayer.Position + (targetPlayer.AssemblyLinearVelocity * predictionFactor)
        Camera.CFrame = CFrame.new(Camera.CFrame.Position, predictedPosition)
    end
end)

-- Anti-Lag
local function removeLagObjects()
    for _, obj in pairs(workspace:GetChildren()) do
        if obj:IsA("Part") or obj:IsA("MeshPart") then
            obj.Material = Enum.Material.SmoothPlastic
            obj.Reflectance = 0
        end
    end
end
removeLagObjects()

-- UI Setup
local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/FakeAngles/PasteWare/refs/heads/main/linoralib.lua"))()
local Window = Library:CreateWindow({
    Title = 'Optimized Script - War Tycoon',
    Center = true,
    AutoShow = true,
    TabPadding = 8,
    MenuFadeTime = 0.2
})

local GeneralTab = Window:AddTab("Main")
local espBox = GeneralTab:AddLeftGroupbox("ESP Settings")
local aimBox = GeneralTab:AddRightGroupbox("AimLock Settings")

espBox:AddToggle("ESP_Enabled", {
    Text = "Enable ESP",
    Default = false,
    Callback = function(value)
        espEnabled = value
        if value then
            createESP()
        else
            for _, box in pairs(espBoxes) do
                box.Visible = false
            end
        end
    end
})

aimBox:AddToggle("AimLock_Enabled", {
    Text = "Enable AimLock",
    Default = false,
    Callback = function(value)
        isLockedOn = value
    end
})

-- NoClip
local isNoClipActive = false
RunService.RenderStepped:Connect(function()
    if isNoClipActive and LocalPlayer.Character then
        for _, part in pairs(LocalPlayer.Character:GetChildren()) do
            if part:IsA("BasePart") then
                part.CanCollide = false
            end
        end
    end
end)

GeneralTab:AddToggle("NoClip_Enabled", {
    Text = "Enable NoClip",
    Default = false,
    Callback = function(value)
        isNoClipActive = value
    end
})

-- Speed Hack
local speedMultiplier = 1
RunService.RenderStepped:Connect(function()
    if speedMultiplier > 1 and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
        LocalPlayer.Character.Humanoid.WalkSpeed = 16 * speedMultiplier
    end
end)

GeneralTab:AddSlider("Speed_Multiplier", {
    Text = "Speed Multiplier",
    Default = 1,
    Min = 1,
    Max = 5,
    Rounding = 1,
    Callback = function(value)
        speedMultiplier = value
    end
})

-- Final Execution
createESP()
